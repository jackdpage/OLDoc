\documentclass[a4paper]{article}
\usepackage{hyperref}
\begin{document}
\title{Pylux User Manual \\ \large{for Pylux v0.1-alpha}}
\author{J. Page}
\date{2015}
\maketitle
\vspace{1.0pt}
Copyright (C)  2015 Jack Page \\
Permission is granted to copy, distribute and/or modify this document
in source form (LaTeX) or compiled form (PDF, PostScript, etc.), including 
for commercial use, provided that this copyright notice is retained and that 
you grant the same freedoms to any recipients of your modifications.
\tableofcontents
\newpage
\section{Introduction}
Pylux is a program written in Python for the manipulation of OpenLighting Plot
documents. Pylux currently allows for the basic editing of the OpenLighting
Plot XML files, including referencing OpenLighting Fixture files to obtain
additional data.

In the future, Pylux will be extended with modules that allow for the exporting
of documentation in the \LaTeX{} format, and creating lighting plots in SVG 
format.

Bugs and feature requests should be submitted to 
\url{https://github.com/jackdpage/pylux/issues}.

\section{Command-line Options}
Pylux is invoked simply by running the \texttt{plotter.py} program. Windows 
operating systems should automatically associate file with the Python 
interpreter. The program contains a shebang line for compatibility with UNIX
systems. 

\paragraph{\texttt{--help}, \texttt{-h}}
Display the usage message of the program then exit.

\paragraph{\texttt{--version}, \texttt{-v}}
Display the version number of the program then exit.

\paragraph{\texttt{--file \textit{FILE}}, \texttt{-f \textit{FILE}}} 
Load the file with path \texttt{\textit{FILE}} as the project file on launch.

\paragraph{\texttt{--interface \textit{INTERFACE}}, \texttt{-i 
\textit{INTERFACE}}}
Launch Pylux with the interface with identifier \texttt{\textit{INTERFACE}}.
\texttt{\textit{INTERFACE}} is either \texttt{cli} or \texttt{gui} depending on 
whether you want to launch the command line interface or graphical user 
interface respectively. The default is \texttt{cli}.

\section{Basic Concepts}
Pylux uses the OpenLighting Plot format as its document format. This format 
specifies three main components of an XML document: the meta section, the 
fixtures section and the registries section. In its current version, Pylux 
can only read and write to the latter two sections.

The fixtures section contains multiple fixture elements, each of which has 
various data associated with it, depending on the fields as defined by the 
fixture's OpenLighting ID (olid).

The registries section contains one or more DMX registries, each of which 
contains some channel elements, which contain both the UUID of the fixture 
they control and their function.

\section{Using the Command Line Interface}
Pylux ships with two interface modes: a command line interface (CLI) and a 
graphical user interface (GUI). The interface that is loaded on launch is 
specified by the interface flag when the program is run. However, the 
default interface is the CLI. When the CLI launches, you are presented with an 
interactive prompt, which accepts commands which may also have arguments. Each 
command is two letters long (apart from the utility commands), where the first 
letter represents the aspect that the command affects and the second letter 
represents the action of the command.

When you are using the CLI, you will notice that some commands call for you 
to provide an interface reference id (usually called \texttt{\textit{REF}} 
in the command synopsis). This allows you to easily pass objects that have 
been listed on-screen into another command. You can tell which references are 
legal because they will be underlined. For example to pipe a fixture object 
into the \texttt{xs} command, you would first run a command which lists the 
fixture you wish to change (\texttt{xl} or \texttt{xf}), find the interface 
reference of that fixture, then use that reference in the \texttt{xs} 
command. In addition to these references, there is an additional special 
reference which is not displayed on-screen which is called using the 
reference \texttt{this}. This special reference will refer to the object that 
was previously worked on. For example, if you perform \texttt{xs} on a fixture 
then wish to perform another \texttt{xs} immediately afterwards, you can use 
\texttt{this} instead of the interface reference.

\subsection{Utility Commands}

\paragraph{\texttt{h}}
Display a list of the available commands for the interactive prompt. This 
prints the contents of \texttt{help.txt}  to the output.

\paragraph{\texttt{c}}
Clears the screen of previous input and output. This uses the system screen 
clearing command. (\texttt{clear} on UNIX, \texttt{cls} on Windows)

\paragraph{\texttt{q}}
Exit the program and autosave any changes that have been made to the tree.

\paragraph{\texttt{Q}}
Exit the program without saving any changes to disk.

\subsection{File Commands}

\paragraph{\texttt{fl \textit{FILE}}}
Load the file with path \texttt{\textit{FILE}} as the project file. This will 
override any unsaved buffer associated with the previous project file, if there 
was one.

\paragraph{\texttt{fs}}
Save the current file buffer to its original location.

\paragraph{\texttt{fS \textit{PATH}}}
Save the current file buffer to a new file with location \texttt{\textit{PATH}}.

\subsection{Metadata Commands}

\paragraph{\texttt{ml}}
List all the metadata tags associated with the currently loaded project
file.

\paragraph{\texttt{ma \textit{TAG VALUE}}}
Add a new piece of metadata. Adds a new tag with the name \texttt{\textit{TAG}}
to the metadata section and sets its value to \texttt{\textit{VALUE}}.

\paragraph{\texttt{mr \textit{TAG}}}
Remove the piece of metadata from the file which has the name 
\texttt{\textit{TAG}}.

\paragraph{\texttt{mg \textit{TAG}}}
Get the value of a piece of metadata. Prints the value of the metadata with
name \texttt{\textit{TAG}} on the screen.

\subsection{Fixture Commands}

\paragraph{\texttt{xa \textit{OLID}}}
Add a new fixture to the plot. This will add a fixture to the plot with olid 
\texttt{\textit{OLID}}. It will also automatically assign a UUID and search 
the OLF file associated with this olid for any constants that this fixture has and add them to the fixture. This will not assign DMX addresses to the fixture,
use \texttt{xA} for that.

\paragraph{\texttt{xl}}
List all the fixtures in the plot. This will generate a list of every fixture 
in the plot, listing an interface reference, the fixture olid, and the fixture 
UUID.

\paragraph{\texttt{xf \textit{TAG VALUE}}}
List all the fixtures in the plot which have a tag called \texttt{\textit{TAG}} 
with a value of \texttt{\textit{VALUE}}. Like the list function, this will list 
an interface reference, the fixture olid and UUID, and also the value of the 
tag that was given for verification purposes.

\paragraph{\texttt{xi \textit{REF}}}
List all the information associated with the fixture with interface reference 
\texttt{\textit{REF}}.

\paragraph{\texttt{xr \textit{REF}}}
Remove the fixture with the interface reference \texttt{\textit{REF}}. This 
fixture will be removed from the plot, but associated DMX channels will not be 
removed, use \texttt{xp} for that.

\paragraph{\texttt{xs \textit{REF TAG VALUE}}}
Set the value of \texttt{\textit{TAG}} in fixture with interface reference 
\texttt{\textit{REF}} to \texttt{\textit{VALUE}}.

\paragraph{\texttt{xA \textit{REF UNIVERSE ADDR}}}
Assign DMX addresses to the fixture with interface reference 
\texttt{\textit{REF}}. This will add the fixture to the universe 
\texttt{\textit{UNIVERSE}}, beginning at the start address 
\texttt{\textit{ADDR}}. \texttt{\textit{ADDR}} can either be a user-assigned 
number or auto to allow Pylux to choose the most appropriate start address.

\subsection{DMX Registry Commands}

\paragraph{\texttt{rl \textit{UNIVERSE}}}
List all the used channels in \texttt{\textit{UNIVERSE}}. This will list the 
DMX address, fixture UUID and function of every channel in the DMX registry 
with identifier \texttt{\textit{UNIVERSE}}.

\section{Using the Graphical User Interface}
You may instead choose to launch Pylux using its GUI. This is NYI so please 
don't.

\subsection{Using Extensions}
You cannot directly interact with extensions from the \texttt{plotter} 
interface, you must first load the extension using the \texttt{:} command.
For example, to load the \texttt{texlux} extension, use \texttt{:texlux}. 
This will then present you with the interface as defined by that extension 
which may vary but in practise should be a prompt of the form 
\texttt{pylux:extension} to indicate to you which extension you are 
operating in and some commands, much like in the \texttt{plotter} interface.
The extension defines its own way of returning to \texttt{plotter} but this 
should in general be \texttt{::} or \texttt{q}.

\section{Extensions}
In the previous sections, we have discussed the usage of the base program in 
Pylux: \texttt{plotter}. This is the program that you will use to edit your
plots, however, beyond that, it doesn't do much. That is why Pylux is also 
bundled with extensions to provide extra functionality. In the current 
version, Pylux comes bundled with the \texttt{texlux} extension only.

\subsection{\texttt{texlux}}
\texttt{texlux} is an extension to the base \texttt{plotter} program which allows for the creation of reports in the \LaTeX{} format, which can then be 
post-processed to create a PDF file, or many other formats through the use of 
an external tool such as Pandoc.

\subsubsection{Commands}

\paragraph{\texttt{rg \textit{TEMPLATE OUTPUT TITLE}}}
Generates a report using the template \texttt{\textit{TEMPLATE}}, with the 
title \texttt{\textit{TITLE}}, writing the output to a file with path 
\texttt{\textit{OUTPUT}}.

\subsubsection{Processing}

\texttt{texlux} uses built-in functions to generate \LaTeX{} docments with 
pre-defined structures. Each built-in function has a corresponding \LaTeX{} 
style file installed in \texttt{~/.pylux/tex/} which is required to build the 
PDF report. Currently the only built-in function is \texttt{dimmer}, which 
produces a report categorised by dimmer and containing power draw totals.

\section{Developing for Pylux}
For the most part, Pylux is documented using Python docstrings, meaning you 
can access most documentation using the \texttt{pydoc} command. However, it 
is documented here anyway for the sake of legibility.

If you are developing an external program or interface and wish to use the 
Pylux system, Pylux provides an API to allow you to easily control the data of 
plot files in the form of the \texttt{plot} module. Once you have installed 
Pylux onto your system, you can then import this using 
\texttt{from pylux import plot}. This gives you access to a variety of 
objects to manipulate Pylux plot files.

Before each API function is documented, it is important to look at the 
structure of Pylux: an XML file, called a Pylux plot, is read and its data 
parsed using the \texttt{xml.etree.ElementTree} module. This means that the 
full XML tree is available in Python. However, Pylux does not directly edit 
this XML tree. Instead, Pylux creates empty Python objects then loads the 
data from the XML tree into these. This allows for easy editing and adding of 
information to these objects. Once these objects have been edited, they are 
then written back to the XML tree (usually using a \texttt{save()} function). 
Once Pylux is finished with a document, or when a user explicitly requests, 
it will then write the new tree back to the original XML file (or a new one if 
it has been specified). Your code should never directly alter or read from 
the XML tree. \texttt{plotter} doesn't even import the tree parser to ensure 
this. You should always access these objects via the API.

\subsection{The \texttt{PlotFile} class}
This class deals with the Pylux plot file that is being used. There is no 
initialisation function.

\subsubsection{Functions of \texttt{PlotFile}}

\paragraph{\texttt{load(self, path)}}
Loads the file with location \texttt{path} as the working plot file. It will 
then parse the file into a Python-usable XML tree and store it in 
\texttt{tree}. It will then get the root element from the tree and store it in 
\texttt{root}.

\paragraph{\texttt{save()}}
Saves the current state of the XML working tree to the location from which 
the plot file was originally loaded.

\paragraph{\texttt{saveas(path)}}
Saves the current state of the XML working tree to the location with path 
\texttt{path}.

\paragraph{\texttt{generate(path)}}
Creates an empty plot file containing the \texttt{olplot}, \texttt{metadata} 
and \texttt{fixtures} tags at the location with path \texttt{path}. This does 
not load the file as the working file.

\subsubsection{Attributes of \texttt{PlotFile}}
Whilst there are attributes defined in the \texttt{PlotFile} class, in 
general they should not be used by extensions as this breaks down the 
tiered structure explained in the opening paragraph.

\paragraph{\texttt{file}}
The path of the plot file.

\paragraph{\texttt{tree}}
The Python XML tree element that was parsed from the file using 
\texttt{xml.etree.ElementTree}.

\paragraph{\texttt{root}}
The root element (\texttt{olplot}) of the plot file.

\subsection{The \texttt{DmxRegistry} class}
The \texttt{DmxRegistry} class is Pylux's method for managing DMX registries. 
If you are using more than one DMX registry, each registry should call a new 
instance of \texttt{DmxRegistry}.

\subsubsection{Functions of \texttt{DmxRegistry}}

\paragraph{\texttt{__init__(plot_file, universe)}}
This creates a new Python registry and sets its \texttt{universe} attribute 
to universe that was given as a parameter. It will then search the XML tree 
for a DMX registry with this universe id. If it finds one with the correct 
universe id, it will load the contents of that XML registry into the Python 
registry (a dictionary in the form \texttt{\{address: (uuid, func), ...\}}).
If it cannot find a registry with this universe id, it will instead create a 
new XML DMX registry object and add this to the tree.

\end{document}
